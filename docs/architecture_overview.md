## ðŸ—ï¸ Architecture Overviewï¼ˆå…¨ä½“æ§‹é€ ã¨å„å±¤ã®è²¬å‹™ï¼‰

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ Kafka.Ksql.Linq OSS ã® **å†…éƒ¨è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** ã¨ã—ã¦ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“ã¨å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ã‚’æ˜Žç¢ºåŒ–ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

âš ï¸ DSL åˆ©ç”¨è€…å‘ã‘ã®æ¦‚è¦ã§ã¯ãªãã€OSS æœ¬ä½“ã®æ”¹å¤‰ãƒ»æ‹¡å¼µã«é–¢ã‚ã‚‹é–‹ç™ºè€…å‘ã‘è³‡æ–™ã§ã™ã€‚

---

### ðŸ§± ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã¨è²¬å‹™

| ãƒ¬ã‚¤ãƒ¤ãƒ¼å                       | ä¸»ãªè²¬å‹™æ¦‚è¦                                                                 |
|----------------------------------|------------------------------------------------------------------------------|
| Applicationå±¤                   | DSLè¨˜è¿°ï¼ˆ`KsqlContext`ç¶™æ‰¿ + `OnModelCreating`ï¼‰                             |
| Contextå®šç¾©å±¤                   | DSLè§£æžã¨ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ï¼ˆ`KsqlContext`, `KsqlModelBuilder`ï¼‰                    |
| Entity Metadataç®¡ç†å±¤           | POCOå±žæ€§è§£æžã€Kafka/Schema Registry ç”¨è¨­å®šç”Ÿæˆ                              |
| ã‚¯ã‚¨ãƒªæ§‹ç¯‰å±¤ï¼ˆLINQâ†’KSQLå¤‰æ›ï¼‰   | LINQå¼è§£æžã€KSQLæ§‹æ–‡ç”Ÿæˆã€å¼ãƒ„ãƒªãƒ¼è¨ªå•                                     |
| ã‚¹ãƒˆãƒªãƒ¼ãƒ æ§‹æˆå±¤               | KStream/KTableæ§‹æˆã€Windowå‡¦ç†ã€Joinã€DLQã€Finalå‡ºåŠ›ãªã©                    |
| Kafka I/Oå±¤ï¼ˆå¤–éƒ¨é€£æºï¼‰         | Kafkaã‚¯ãƒ©ã‚¹ã‚¿æŽ¥ç¶šã€ãƒˆãƒ”ãƒƒã‚¯ç®¡ç†ã€RocksDBæ“ä½œã€Schema Registryé€£æºãªã©     |

å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è©³ç´°æ§‹é€ ã‚„ä¸»ãªã‚¯ãƒ©ã‚¹ã«ã¤ã„ã¦ã¯ã€`docs/namespaces/` é…ä¸‹ã«ã¦ Namespace å˜ä½ã§èª¬æ˜Žã•ã‚Œã¾ã™ã€‚

---

### ðŸ” ä»–ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®é–¢ä¿‚

- `docs_configuration_reference.md` â†’ DSLã¨appsettingsã®ãƒžãƒƒãƒ”ãƒ³ã‚°è§£èª¬
- `docs_advanced_rules.md` â†’ é‹ç”¨æ™‚ã®åˆ¶ç´„ã¨è¨­è¨ˆåˆ¤æ–­ã®èƒŒæ™¯
- `dev_guide.md` â†’ æ©Ÿèƒ½è¿½åŠ ãƒ»DSLæ‹¡å¼µæ‰‹é †ã®å®Ÿè£…ãƒ«ãƒ¼ãƒ«
- `docs/namespaces/*.md` â†’ å„å±¤ã«å¯¾å¿œã™ã‚‹Namespaceã”ã¨ã®å®Ÿè£…è²¬å‹™ã¨æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

---

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€è¨­è¨ˆæ§‹é€ ã®ä¿¯çž°ã¨è²¬å‹™åˆ†é›¢ã®ç†è§£ã‚’ä¿ƒã™ã‚‚ã®ã§ã‚ã‚Šã€æ‹¡å¼µæ™‚ã®å‡ºç™ºç‚¹ãƒ»ç´¢å¼•ã¨ã—ã¦æ´»ç”¨ã•ã‚Œã¾ã™ã€‚

â€» å›³è§£ã‚„ä¾å­˜é–¢ä¿‚ãƒžãƒƒãƒ—ã¯åˆ¥ç´™äºˆå®š

---

## POCOè¨­è¨ˆãƒ»PKé‹ç”¨ãƒ»ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºæ–¹é‡

æœ¬ç¯€ã§ã¯ OSS ã«ãŠã‘ã‚‹ POCO è¨­è¨ˆæ–¹é‡ã€PK é‹ç”¨ãŠã‚ˆã³ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®ãƒãƒªã‚·ãƒ¼ã‚’ã¾ã¨ã‚ã¾ã™ã€‚å†…å®¹ã¯ [reports/20250708.txt](../reports/20250708.txt) ã‚’ã‚‚ã¨ã«ã€é¡èŠ±ãƒ»æ¥ æœ¨ãƒ»åºƒå¤¢ãŒæ•´ç†ã—ã¾ã—ãŸã€‚

### 1. POCO è¨­è¨ˆåŽŸå‰‡
- æ¥­å‹™ POCO ã¯ **ç´”ç²‹ãªæ¥­å‹™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ** ã¨ã—ã€ã‚­ãƒ¼æŒ‡å®šç”¨ã®å±žæ€§ã¯ä»˜ä¸Žã—ãªã„ã€‚
- DB éƒ½åˆã‚„ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯éƒ½åˆã§è‡ªç”±ã«è¨­è¨ˆã—ã€Kafka ã® key schema ã‚’æ„è­˜ã—ãªã„ã€‚

### 2. PK é‹ç”¨ãƒ«ãƒ¼ãƒ«
- PK (key schema) ã¯ DTO/POCO ã® **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®šç¾©é †** ã®ã¿ã‚’åŸºæº–ã«è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€‚
- `Key` å±žæ€§ã¯è¨­è¨ˆãƒ»å®Ÿè£…ã‹ã‚‰é™¤å¤–ã—ã€è¤‡åˆã‚­ãƒ¼ã®é †åºã¯ DTO/POCO ã®å®šç¾©é †ã«å¾“ã†ã€‚
- ã‚­ãƒ¼ã«åˆ©ç”¨ã§ãã‚‹åž‹ã¯ `int` `long` `string` `Guid` ã®4ç¨®é¡žã®ã¿ã¨ã—ã€ãã®ä»–ã¯åˆ©ç”¨è€…å´ã§å¤‰æ›ã™ã‚‹ã€‚
- LINQ `group by` ãªã©ã§æŒ‡å®šã—ãŸè«–ç† PK ã®é †åºã¨ä¸€è‡´ã•ã›ã‚‹ã€‚
- `GroupBy` ã‚„ `Join` ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼é †ã¨ DTO/POCO ã®å®šç¾©é †ãŒä¸€è‡´ã—ãªã„å ´åˆã€åˆæœŸåŒ–æ™‚ã« `InvalidOperationException` ã‚’é€å‡ºã™ã‚‹ã€‚
  ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ **"GroupByã‚­ãƒ¼ã®é †åºã¨å‡ºåŠ›DTOã®å®šç¾©é †ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚å¿…ãšåŒã˜é †åºã«ã—ã¦ãã ã•ã„ã€‚"** ã¨ã™ã‚‹ã€‚

### 3. ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºæ–¹é‡
- POCO â‡” key/value æ§‹é€ ä½“ã®å¤‰æ›ã¯ **å®Œå…¨è‡ªå‹•** ã§å®Ÿè¡Œã™ã‚‹ã€‚
- Produce æ™‚ã¯ DTO/POCO ã‹ã‚‰ PK éƒ¨ã¨ Value éƒ¨ã‚’è‡ªå‹•åˆ†é›¢ã—ã¦ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã€‚
- Consume æ™‚ã¯ Kafka ã‹ã‚‰å—ä¿¡ã—ãŸ key/value ã‚’ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã€ DTO/POCO ã«å†æ§‹æˆã™ã‚‹ã€‚
- ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ï¼ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã¯åž‹ãƒ»ã‚¹ã‚­ãƒ¼ãƒžæ¯Žã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—æ€§èƒ½ã‚’ç¢ºä¿ã™ã‚‹ã€‚

### 4. é‹ç”¨ä¸Šã®ãƒã‚¤ãƒ³ãƒˆ
- ä»¥ä¸Šã®æ–¹é‡ã¯å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚¬ã‚¤ãƒ‰ã«æ˜Žè¨˜ã—ã€ãƒãƒ¼ãƒ å…¨å“¡ã§éµå®ˆã™ã‚‹ã€‚
- é€²æ—ã‚„èª²é¡ŒãŒã‚ã‚Œã°å¤©åŸŽï¼ˆPMï¼‰ã¸éšæ™‚ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã€‚

ä½œæˆ: åºƒå¤¢ / ç›£ä¿®: é¡èŠ±ãƒ»æ¥ æœ¨

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [getting-started.md](./getting-started.md)
- [docs_advanced_rules.md](./docs_advanced_rules.md)
- [EntitySet ã‹ã‚‰ Messaging ã¾ã§ã®åˆ©ç”¨ã‚¹ãƒˆãƒ¼ãƒªãƒ¼](./architecture/entityset_to_messaging_story.md)
- [Key-Value Flow Architecture (POCO â†” Kafka)](./architecture/key_value_flow.md)
- [Query -> KsqlContext -> Mapping/Serialization Flow](./architecture/query_ksql_mapping_flow.md)
- [Query to AddAsync Flow Sample](./architecture/query_to_addasync_sample.md)

